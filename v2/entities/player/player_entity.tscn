[gd_scene format=3 uid="uid://d0rgswc73h64f"]

[ext_resource type="Script" uid="uid://bnop7vr1q4gwg" path="res://entities/player/player_entity.gd" id="1_0jc3c"]
[ext_resource type="PackedScene" uid="uid://4m8or6jc5xbd" path="res://entities/player/components/camera_controller.tscn" id="2_bls4j"]
[ext_resource type="PackedScene" uid="uid://bgr8550flctkg" path="res://entities/player/bikes/assets/sports_bike/scene.gltf" id="2_faflk"]
[ext_resource type="PackedScene" uid="uid://2nnr6ecxbcgo" path="res://entities/player/components/movement_controller.tscn" id="2_fkugw"]
[ext_resource type="Script" uid="uid://0q8vxps631w4" path="res://entities/components/mesh_component.gd" id="3_0jc3c"]
[ext_resource type="Script" uid="uid://d350u8evihs1u" path="res://addons/netfox/rollback/rollback-synchronizer.gd" id="3_faflk"]
[ext_resource type="Script" uid="uid://dour8fehaaugp" path="res://addons/netfox/tick-interpolator.gd" id="4_ri2qi"]
[ext_resource type="Script" uid="uid://d37r06yj5krm" path="res://entities/player/components/input_controller.gd" id="7_mrv5j"]

[sub_resource type="GDScript" id="GDScript_ri2qi"]
script/source = "@tool
## All mesh objects should be defined from this
class_name MeshDefinition extends Resource

@export var mesh_scene: PackedScene
@export var mesh_position_offset: Vector3 = Vector3.ZERO
@export var mesh_rotation_offset_degrees: Vector3 = Vector3.ZERO
@export var mesh_scale_multiplier: Vector3 = Vector3.ONE
"

[sub_resource type="Resource" id="Resource_37iic"]
script = SubResource("GDScript_ri2qi")
mesh_scene = ExtResource("2_faflk")
mesh_rotation_offset_degrees = Vector3(0, 180, 0)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hgb8f"]
radius = 0.4

[sub_resource type="GDScript" id="GDScript_1vqn6"]
script/source = "@tool
## All Bike objects should be defined from this
class_name BikeDefinition extends Resource

@export var bike_mesh_definition: MeshDefinition

@export_group(\"Bike Collision\")
@export var collision_shape: Shape3D
@export var collision_position_offset: Vector3 = Vector3.ZERO
@export var collision_rotation_offset_degrees: Vector3 = Vector3.ZERO
@export var collision_scale_multiplier: Vector3 = Vector3.ONE

# TBD:
# @export var color_override: Color
# @export var mods: Array[BikeMod]
# BikeMod is a MeshDefinition with an attachment point Marker3D w/ script

# transforms...
# player_entity.gd should use this to set vals from
"

[sub_resource type="Resource" id="Resource_lfjd4"]
script = SubResource("GDScript_1vqn6")
bike_mesh_definition = SubResource("Resource_37iic")
collision_shape = SubResource("CapsuleShape3D_hgb8f")
collision_position_offset = Vector3(0, 0.4, 0)
collision_rotation_offset_degrees = Vector3(90, 0, 0)
metadata/_custom_type_script = "uid://byqlh6e8c6qvl"

[node name="PlayerEntity" type="CharacterBody3D" unique_id=1507519799 node_paths=PackedStringArray("camera_controller", "movement_controller", "input_controller", "mesh_component", "mesh_node", "collision_shape_3d")]
script = ExtResource("1_0jc3c")
bike_definition = SubResource("Resource_lfjd4")
camera_controller = NodePath("_Components/CameraController")
movement_controller = NodePath("_Components/MovementController")
input_controller = NodePath("_Components/InputController")
mesh_component = NodePath("MeshComponent")
mesh_node = NodePath("MeshNode")
collision_shape_3d = NodePath("CollisionShape3D")
metadata/_custom_type_script = "uid://bnop7vr1q4gwg"

[node name="RollbackSynchronizer" type="Node" parent="." unique_id=609748778 node_paths=PackedStringArray("root")]
unique_name_in_owner = true
script = ExtResource("3_faflk")
root = NodePath("..")
enable_prediction = true
state_properties = Array[String]([":global_transform", ":velocity", "%MovementController:current_speed", "%MovementController:angular_velocity"])
input_properties = Array[String](["%InputController:throttle", "%InputController:front_brake", "%InputController:steer", "%InputController:lean"])
metadata/_custom_type_script = "uid://d350u8evihs1u"

[node name="TickInterpolator" type="Node" parent="." unique_id=977812349 node_paths=PackedStringArray("root")]
script = ExtResource("4_ri2qi")
root = NodePath("..")
properties = Array[String]([":global_transform", ":velocity", "%MovementController:current_speed", "%MovementController:angular_velocity"])
metadata/_custom_type_script = "uid://dour8fehaaugp"

[node name="CollisionShape3D" type="CollisionShape3D" parent="." unique_id=412612653]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0.4, 0)
shape = SubResource("CapsuleShape3D_hgb8f")

[node name="MeshNode" type="Node3D" parent="." unique_id=430093319]
unique_name_in_owner = true

[node name="MeshComponent" type="Node3D" parent="." unique_id=1152989109 node_paths=PackedStringArray("mesh_node")]
script = ExtResource("3_0jc3c")
mesh_definition = SubResource("Resource_37iic")
mesh_node = NodePath("../MeshNode")
metadata/_custom_type_script = "uid://0q8vxps631w4"

[node name="_Components" type="Node3D" parent="." unique_id=1446485892]

[node name="InputController" type="Node3D" parent="_Components" unique_id=745640607 node_paths=PackedStringArray("player_entity")]
unique_name_in_owner = true
script = ExtResource("7_mrv5j")
player_entity = NodePath("../..")

[node name="MovementController" parent="_Components" unique_id=1521291056 node_paths=PackedStringArray("player_entity", "input_controller") instance=ExtResource("2_fkugw")]
unique_name_in_owner = true
player_entity = NodePath("../..")
input_controller = NodePath("../InputController")
acceleration = 20.0
brake_decel = 40.0
engine_brake_decel = 5.0
turn_speed = 2.0

[node name="CameraController" parent="_Components" unique_id=816730707 node_paths=PackedStringArray("fps_marker", "tps_marker") instance=ExtResource("2_bls4j")]
fps_marker = NodePath("../../Markers/FPSCamMarker")
tps_marker = NodePath("../../Markers/TPSCamMarker")

[node name="FPSCam" parent="_Components/CameraController" index="0" unique_id=634464672]
transform = Transform3D(1, 0, 0, 0, 0.96592575, 0.258819, 0, -0.258819, 0.96592575, 0, 1.2021662, 0)

[node name="TPSCam" parent="_Components/CameraController" index="1" unique_id=1953618350]
transform = Transform3D(1, 0, 0, 0, 0.9370628, 0.34916094, 0, -0.34916094, 0.9370628, 0, 1.391123, 1.7631481)

[node name="Markers" type="Node3D" parent="." unique_id=894866869]

[node name="FPSCamMarker" type="Marker3D" parent="Markers" unique_id=2035762363]
transform = Transform3D(1, 0, 0, 0, 0.96592575, 0.258819, 0, -0.258819, 0.96592575, 0, 1.2021662, 0)

[node name="TPSCamMarker" type="Marker3D" parent="Markers" unique_id=748255221]
transform = Transform3D(1, 0, 0, 0, 0.9370628, 0.34916094, 0, -0.34916094, 0.9370628, 0, 1.391123, 1.7631481)

[node name="NameLabel" type="Label3D" parent="." unique_id=1811367941]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.7594975, 0)
text = "USERNAME"

[editable path="_Components/MovementController"]
[editable path="_Components/CameraController"]
